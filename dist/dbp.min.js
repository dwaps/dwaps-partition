function dwapsBuilderPart(){return function(t,e){return new DWAPS_BUILDER_PART(t,e)}}var options={debugMode:!1,use:{angular:!0},font:{family:"Arial",size:10,weight:300},bgColor:"#eed",default:{location:"lib",resources:"res",responsive:!0,manualMode:!1,sidePadding:10,offsetY:40,measureWidth:500,time:"4/4",colorNotes:"red"},help:{clefs:function(t){console.log("\nValables Clefs :"),console.log(t.clefProperties.values)},notes:function(t){console.log("\nValables Notes :"),console.log(t.keyProperties.note_values)},accidentals:function(t){console.log("\nValables Accidentals :"),console.log(t.accidentalCodes.accidentals)},keys:function(t){console.log("\nValables Keys :"),console.log(t.keySignature.keySpecs)},duration:function(t){console.log("\nValables Duration :"),console.log(t.durationToTicks.durations)},articulations:function(t){console.log("\nValables Articulations :"),console.log(t.articulationCodes.articulations)},ornaments:function(t){console.log("\nValables Ornaments :"),console.log(t.ornamentCodes.ornaments)}}};options.use.angular&&angular.module("DWAPS_BUILDER_PART",[]).factory("dwapsBuilderPart",dwapsBuilderPart);var DWAPS_BUILDER_PART=function(t,e){function s(t,e){var s=new X2JS,i=s.xml_str2json(e);a.initPart(i["score-partwise"]),a.start(t,options,!1)}function i(t){for(var e=document.querySelector("#loading"),s=document.querySelector("#scriptVex"),i=document.querySelectorAll("script"),r=null,n=document.querySelector("#scriptX2JS"),o=document.querySelector(".linkVex"),c="",f=0;f<i.length;f++)i[f].src.match("dwaps-partition")&&(r=i[f]);n||(n=document.createElement("script"),n.id="scriptX2JS",c=options.debugMode?"":".min",n.src=options.default.location+"/dwaps-partition/lib/abdmob/x2js/xml2json"+c+".js",r.parentNode.insertBefore(n,r)),t?(s?document.removeChild(o):(s=document.createElement("script"),s.id="scriptVex"),c=options.debugMode?"debug":"min",s.src=options.default.location+"/dwaps-partition/node_modules/vexflow/releases/vexflow-"+c+".js"):(s?s=s:(s=document.createElement("script"),s.id="scriptVex",o=document.createElement("link"),o.id="linkVex",o.rel="stylesheet",o.href=options.default.location+"/dwaps-partition/node_modules/vextab/releases/vextab.css",document.head.appendChild(o)),s.src=options.default.location+"/dwaps-partition/node_modules/vextab/releases/vextab-div.js"),r.parentNode.insertBefore(s,r),e||(e=document.createElement("div"),e.id="loading",e.className="animated",e.setAttribute("style","\t\t\t\t\t\t\t\t\t\t\t\tposition: absolute;\t\t\t\t\t\t\t\t\t\t\t\ttop: 0; bottom: 0;\t\t\t\t\t\t\t\t\t\t\t\tright: 0; left: 0;\t\t\t\t\t\t\t\t\t\t\t\tbackground: rgba( 30, 30, 30, .5 );\t\t\t\t\t\t\t\t\t\t\t\tz-index: 999999;\t\t\t\t\t\t\t\t\t\t\t\t"),a.loading=e,document.body.appendChild(e))}var a=this;if(this.firstStart=!0,e)i(!0),setTimeout(function(){s(t,e)},200);else{i(!1);var r=new XMLHttpRequest;r.open("GET",options.default.resources+"/"+t+"msp.xml"),r.onprogress=function(){console.log("Chargement de la partition...")},r.onload=function(){setTimeout(function(){s(t,r.responseText)},200)},r.send()}window.addEventListener("resize",function(){a.start(t,!0)},!1)};DWAPS_BUILDER_PART.prototype={initObject:function(t,e,s){if(this.options=t,this.manualMode=t.default.manualMode,this.responsive=t.default.responsive,this.NB_MAX_MEASURES=0,this.offsetX=t.default.sidePadding,this.offsetY=t.default.offsetY,this.calculNbMeasures(),this.NB_PORTEES_SYSTEME=this.partition&&this.partition.systeme.portee2?2:1,this.calculSizeViewer(),this.leftMargin=t.default.sidePadding,this.firstStart)return e instanceof HTMLElement&&(this.tag=e,this.VF=Vex.Flow),this.createViewerPart(),this.mode="major",this.en={DOb:"Cb",SOLb:"Bb",REb:"Db",LAb:"Ab",MIb:"Eb",SIb:"Bb",FA:"F",DO:"C",SOL:"G",RE:"D",LA:"A",MI:"E#",SI:"B#",FAd:"F#",DOd:"D#"},this.mesStaticPart=[],this.mesDynamicPart=[],this.mesMelodie=[],this.mesVF=[],this.SIZES_SYSTEM_AUTO=!0,this.largTotaleMes=0,this.indexFirstMeasureSystem=0,this.mesWidth=[],this.CLE_SOL="treble",this.CLE_FA="bass",this.clef=this.CLE_SOL,this.chiffrage=t.default.time,this.armature=null,this.note={DO:"c",RE:"d",MI:"e",FA:"f",SOL:"g",LA:"a",SI:"b",DO_POINTEE:"c.",RE_POINTEE:"d.",MI_POINTEE:"e.",FA_POINTEE:"f.",SOL_POINTEE:"g.",LA_POINTEE:"a.",SI_POINTEE:"b."},this.figure={RONDE:"w",BLANCHE:"h",NOIRE:"q",CROCHE:"8",DOUBLE_CROCHE:"16",TRIPLE_CROCHE:"32",QUADRUPLE_CROCHE:"64"},this.voix={BASSE:"basse",TENOR:"tenor",ALTO:"alto",SOPRANO:"soprano",NULL:"aucune voix précisée",ACTIVE:""},this.voices=[],this.chords=[],this.colorNotes=t.default.colorNotes,this},calculNbMeasures:function(){if(this.responsive){var t=window.innerWidth;t<=1024?t<=450?this.NB_MAX_MEASURES=1:t<=700?this.NB_MAX_MEASURES=2:t<=768?this.NB_MAX_MEASURES=3:this.NB_MAX_MEASURES=4:this.NB_MAX_MEASURES=0}},calculSizeViewer:function(){var t=parseInt(this.partition.infos.page.width),e=parseInt(this.partition.infos.page.height);if(this.responsive){switch(t=window.innerWidth,e=2==this.NB_PORTEES_SYSTEME?260:135,this.NB_MAX_MEASURES){case 1:e*=this.partition.systeme.portee1.length;break;case 2:e*=this.partition.systeme.portee1.length/2;break;case 3:e*=this.partition.systeme.portee1.length/3;break;case 4:e*=this.partition.systeme.portee1.length/4;break;default:e*=this.partition.systeme.portee1.length/5}e+=this.offsetY}this.widthViewer=t,this.heightViewer=e},initCanvas:function(){this.renderer=new this.VF.Renderer(this.tag,this.VF.Renderer.Backends.SVG),this.renderer.resize(this.widthViewer,this.heightViewer),this.ctx=this.renderer.getContext(),this.ctx.setFont(options.font.family,options.font.size,options.font.weight).setBackgroundFillStyle(options.bgColor)},start:function(t,e,s){e?e:this.options;this.initObject(e,t,s),t instanceof HTMLElement&&(t.innerHTML="",this.initCanvas()),this.buildPart(s)},setOptions:function(t){this.start(this.tag,t,!0)},getOptions:function(){return this.options},initPart:function(t){function e(e){var s=[];return t.part[e-1].measure.forEach(function(t){s.push(t)}),s}var s={infos:{page:{width:t.defaults["page-layout"]["page-width"],height:t.defaults["page-layout"]["page-height"]},titre:t.work["work-title"],ref:t.identification.creator.__text,systeme:[]},systeme:{portee1:e(1),portee2:t.part[1]?e(2):[]}};t["part-list"]["score-part"].forEach(function(t){s.infos.systeme.push(t["part-name"])}),this.partition=s},createViewerPart:function(){return this.viewerPart?this.viewerPart.className="":(this.viewerPart=document.createElement("div"),this.viewerPart.setAttribute("style","\t\t\t\t\t\t\t\t\t\t\t\t-webkit-animation-delay: 1s;\t\t\t\t\t\t\t\t\t\t\t\t-moz-animation-delay: 1s;\t\t\t\t\t\t\t\t\t\t\t\t-ms-animation-delay: 1s;\t\t\t\t\t\t\t\t\t\t\t\t-o-animation-delay: 1s;\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 1s;\t\t\t\t\t\t\t\t\t\t\t\tz-index: 9999;\t\t\t\t\t\t\t\t\t\t\t\t")),this.viewerPart.className="vex-tabdiv animated",this.viewerPart},hideLoading:function(t){var e=this;setTimeout(function(){e.loading.className+=" fadeOut",setTimeout(function(){e.loading.style.zIndex="-1"},t)},t)},buildPart:function(t){this.sizingMeasures(t)},creerMesure:function(t,e,s){function i(t,e){if(e=e?e:0,SPACE_SYSTEM_IN="options space="+18*e,INIT_STAVE="tabstave notation=true tablature=false clef="+m.clef+" key="+m.en.SOL+" time="+m.chiffrage,t){var s=m.responsive?window.innerWidth-10:m.partition.infos.page.width;GENERALES_OPTIONS="options scale=1 font-face=Verdana width="+s,SPACE_SYSTEM_OUT="options space=100",MARGIN_TOP="options space=20",MARGIN_BOTTOM="options space=20",PHRASE_CLE_SOL="notes ",PHRASE_CLE_FA="notes ",CHORDS="text ",TEXT="text ++,.10,.font=Arial-12-normal,"}}function a(t){m.viewerPart.setAttribute("editor",t)}function r(t){m.viewerPart.innerHTML+=t+"\n"}function n(){document.body.appendChild(m.viewerPart),m.viewerPart.className+=" fadeIn"}function o(t,e){var s=!!t.match("-");switch(t=t.replace("-","")){case"1":t=s?e.en.FA:e.en.SOL;break;case"2":t=s?e.en.SIb:e.en.RE;break;case"3":t=s?e.en.MIb:e.en.LA;break;case"4":t=s?e.en.LAb:e.en.MI;break;case"5":t=s?e.en.REb:e.en.SI;break;case"6":t=s?e.en.SOLb:e.en.FAd;break;case"7":t=s?e.en.DOb:e.en.DOd;break;default:t="major"==e.mode?e.en.DO:e.en.LAm}return t}function c(t,e,s,i){mesure=new m.VF.Stave(t.offsetX,t.offsetY+100,t.width),t.firstOnNewSystem&&(mesure.addKeySignature(e),mesure.addClef(m.CLE_FA),mesure.addTimeSignature(i)),mesure.setContext(m.ctx).draw()}function f(t,e,s){var i=[],a={soprano:[],alto:[],tenor:[],basse:[],sansVoix:[]},r=f=e,n=indexMes=s;if(Array.isArray(n.harmony)){m.chords.push([]);var o=m.chords.length-1;n.harmony.forEach(function(t){"minor"==t.kind?m.chords[o].push(t.root["root-step"]+"m"):m.chords[o].push(t.root["root-step"])})}else n.harmony&&m.chords.push([n.harmony.root["root-step"]]);if("object"!==f)if(PHRASE_CLE_SOL=PHRASE_CLE_FA="notes ",indexMes=2==m.NB_PORTEES_SYSTEME?indexMes/2:indexMes,t)for(var c=indexMes-m.NB_MAX_MEASURES;c<m.partition.systeme.portee1.length&&!m.mesDynamicPart[c].lastOnOldSystem;c++){c!=indexMes-m.NB_MAX_MEASURES&&(PHRASE_CLE_SOL+=" | ");var i=m.partition.systeme.portee1[c].note,f="",p="",d="",g="",E=0,S=0,y=!1;i.forEach(function(t,e){switch(p=t.type?t.type:"",d=t.pitch&&t.pitch.step?t.pitch.step:"",g=t.pitch&&t.pitch.octave?parseInt(t.pitch.octave):"",E=S?S:parseInt(t["_default-x"]),p){case"whole":p=":w";break;case"half":p=":h";break;case"quarter":p=":q";break;case"eighth":p=":8";break;case"16th":p=":16";break;case"32nd":p=":32"}if(S=e+1<i.length?parseInt(i[e+1]["_default-x"]):0,E==S&&(y=!0),""!=p&&""!=d&&""!=E){var s=""!=f&&f.match(".$").indexOf(".")!==-1;f+=y?s?d+"/"+g+".":p+"("+d+"/"+g+".":s?d+"/"+g+")":p+d+"/"+g+" "}y=!1}),PHRASE_CLE_SOL+=f}else for(var c=indexMes-m.NB_MAX_MEASURES;c<m.partition.systeme.portee2.length&&!m.mesDynamicPart[c].lastOnOldSystem;c++){c!=indexMes-m.NB_MAX_MEASURES&&(PHRASE_CLE_FA+=" | ");var i=m.partition.systeme.portee2[c].note,f="",p="",d="",g="",E=0,S=0,y=!1;i.forEach(function(t,e){switch(p=t.type?t.type:"",d=t.pitch&&t.pitch.step?t.pitch.step:"",g=t.pitch&&t.pitch.octave?parseInt(t.pitch.octave):"",E=S?S:parseInt(t["_default-x"]),p){case"whole":p=":w";break;case"half":p=":h";break;case"quarter":p=":q";break;case"eighth":p=":8";break;case"16th":p=":16";break;case"32nd":p=":32"}if(S=e+1<i.length?parseInt(i[e+1]["_default-x"]):0,E==S&&(y=!0),""!=p&&""!=d&&""!=E){var s=""!=f&&f.match(".$").indexOf(".")!==-1;f+=y?s?d+"/"+g+".":p+"("+d+"/"+g+".":s?d+"/"+g+")":p+d+"/"+g+" "}y=!1}),PHRASE_CLE_FA+=f}else{if(Array.isArray(n.note)&&"object"===r)n.note.forEach(function(t,e){if(i.push({numMes:parseInt(n._number),voix:t.voice?t.voice:"",pos:t.pitch&&t.pitch.octave?parseInt(t.pitch.octave):"",figure:t.type?t.type:"",ton:t.pitch&&t.pitch.step?t.pitch.step:"",hampe:t.stem?t.stem:"",paroles:[],offsetX:parseInt(t["_default-x"])}),t.lyric)for(j=0;j<t.lyric.length;j++)""!=t.lyric[j].text&&i[e].paroles.push(t.lyric[j].text);""==i[i.length-1].ton&&i.pop()});else{var b=n.note;if(i.push({numMes:parseInt(n._number),voix:b.voice?b.voice:"",pos:b.pitch&&b.pitch.octave?parseInt(b.pitch.octave):"",figure:b.type?b.type:"",ton:b.pitch&&b.pitch.step?b.pitch.step:"",hampe:b.stem?b.stem:"",paroles:[],offsetX:parseInt(b["_default-x"])}),b.lyric)for(j=0;j<b.lyric.length;j++)""!=b.lyric[j].text&&i[c].paroles.push(b.lyric[j].text);""==i[i.length-1].ton&&i.pop()}var _=0;i.forEach(function(t,e){l(t),_=h(n,t,e,a,_)});for(var M in a){var P=[],w=[],v=[],O=[];switch(M){case"soprano":u(a.soprano,a.sansVoix,P),m.creerMelodieMesure(n._number,r,i,t,m.chiffrage,P);break;case"alto":u(a.alto,a.sansVoix,w),m.creerMelodieMesure(n._number,r,i,t,m.chiffrage,w);break;case"tenor":u(a.tenor,a.sansVoix,v),m.creerMelodieMesure(n._number,r,i,t,m.chiffrage,v);break;case"basse":u(a.basse,a.sansVoix,O),m.creerMelodieMesure(n._number,r,i,t,m.chiffrage,O);break;case"sansVoix":}}}}function l(t){if(t){switch(t.figure){case"half":t.figure=m.figure.BLANCHE;break;case"quarter":t.figure=m.figure.NOIRE;break;case"eighth":t.figure=m.figure.CROCHE}switch(t.ton){case"C":t.ton=m.note.DO;break;case"D":t.ton=m.note.RE;break;case"E":t.ton=m.note.MI;break;case"F":t.ton=m.note.FA;break;case"G":t.ton=m.note.SOL;break;case"A":t.ton=m.note.LA;break;case"B":t.ton=m.note.SI}}}function h(t,e,s,i,a){if(s>0&&t.note[s-1]["_default-x"]==e.offsetX)if(a>0)switch(e.voix){case"2":i.alto[a-1]=e;break;case"1":i.tenor[a-1]=e;break;default:i.sansVoix[a-1]=e}else switch(e.voix){case"2":i.alto[0]=e;break;case"1":i.tenor[0]=e;break;default:i.sansVoix[0]=e}else{switch(e.voix){case"2":i.alto.push(e);break;case"1":i.tenor.push(e);break;default:i.sansVoix.push(e)}for(var r in i)a<i[r].length&&(a=i[r].length);for(var r in i)i[r].length<a&&i[r].push(null)}return a}function u(t,e,s){t.forEach(function(t,i){if(t)if(e[i]&&e[i].offsetX==t.offsetX){var a={},r={};if(e[i].pos>t.pos)a={ton:t.ton,figure:t.figure,pos:t.pos,hampe:t.hampe},r={ton:e[i].ton,figure:e[i].figure,pos:e[i].pos,hampe:e[i].hampe};else if(e[i].pos==t.pos){for(var n=["c","d","e","f","g","a","b"],o=-1,c=-1,f=0;f<7;f++)t.ton==n[f]&&(o=f),e[i].ton==n[f]&&(c=f);o>-1&&c>-1&&(o>c?(a={ton:e[i].ton,figure:e[i].figure,pos:e[i].pos,hampe:e[i].hampe},r={ton:t.ton,figure:t.figure,pos:t.pos,hampe:t.hampe}):(a={ton:t.ton,figure:t.figure,pos:t.pos,hampe:t.hampe},r={ton:e[i].ton,figure:e[i].figure,pos:e[i].pos,hampe:e[i].hampe}))}else a={ton:e[i].ton,figure:e[i].figure,pos:e[i].pos,hampe:e[i].hampe},r={ton:t.ton,figure:t.figure,pos:t.pos,hampe:t.hampe};s.push([[a.ton,a.figure,a.pos,a.hampe],[r.ton,r.figure,r.pos,r.hampe]])}else s.push([[t.ton,t.figure,t.pos,t.hampe]])})}var m=this,p=this.options.default.measureWidth,d=[],g=null,E=null,S=null,y=null,b=[],_=0;if(!this.responsive&&t&&s>=0){var M={width:parseInt(t._width)};return t.attributes&&(t.attributes.time&&(this.chiffrage=t.attributes.time.beats+"/"+t.attributes.time["beat-type"]),t.attributes.clef&&(this.clef="G"==t.attributes.clef.sign?this.CLE_SOL:this.CLE_FA),t.attributes.key&&(t.attributes.key.fifths&&(this.armature=t.attributes.key.fifths),t.attributes.key.mode&&(this.mode=t.attributes.key.mode))),t.print&&("yes"!=t.print["_new-system"]&&"yes"!=t.print["_new-page"]||(this.indexFirstMeasureSystem=parseInt(t._number)-1,this.leftMargin=this.options.default.sidePadding,"yes"==t.print["_new-system"]&&(this.offsetY+=120),M.clef=this.clef,M.chiffrage=this.chiffrage,M.armature=this.armature,0==s&&t.print["system-layout"]&&t.print["system-layout"]["system-margins"]&&t.print["system-layout"]["system-margins"]["left-margin"]&&(this.leftMargin=parseInt(t.print["system-layout"]["system-margins"]["left-margin"]),this.leftMargin=this.leftMargin-15))),this.offsetX=this.leftMargin,s>0&&"1"!=t._number&&(!t.print||t.print&&"yes"!=t.print["_new-system"]&&"yes"!=t.print["_new-page"]?this.calculOffsetX(s):this.calculOffsetX(s)),M.offsetX=this.offsetX,M.offsetY=this.offsetY,void this.creerMesure(M,e)}parseInt(t.offsetX)&&(offsetX=t.offsetX),parseInt(t.offsetY)&&(offsetY=t.offsetY),parseInt(t.width)&&(p=t.width),t.clef&&(g=this.clef),t.chiffrage&&(E=this.chiffrage);var P=this.responsive?this.mesDynamicPart:this.mesStaticPart,w=0;P.length>0&&!this.manualMode?(this.tag||(i(!0),a(!0),r(GENERALES_OPTIONS),r(MARGIN_TOP)),P.forEach(function(t,s){if(m.tag){if(2==m.NB_PORTEES_SYSTEME)if(s%2==0)if(mesure=new m.VF.Stave(t.offsetX,t.offsetY,t.width),t.firstOnNewSystem&&(S=o(m.armature,m),S||(S=m.armature),mesure.addKeySignature(S),g=t.clef,g||(g=m.clef),mesure.addClef(g),E=t.chiffrage,E||(E=m.chiffrage),mesure.addTimeSignature(E)),mesure.setContext(m.ctx).draw(),e)for(var a=0;a<m.mesMelodie.length;a++)a%2==0&&m.VF.Formatter.FormatAndDraw(m.mesMelodie[a][0],m.mesMelodie[a][1],m.mesMelodie[a][2]);else f(!0,mesure,m.partition.systeme.portee1[w]);else{if(c(P[s-1],S,g,E),e)for(var a=0;a<m.mesMelodie.length;a++)a%2!=0&&m.VF.Formatter.FormatAndDraw(m.mesMelodie[a][0],m.mesMelodie[a][1],m.mesMelodie[a][2]);else f(!1,mesure,m.partition.systeme.portee2[w]);w++}}else 2==m.NB_PORTEES_SYSTEME&&(s%2==0&&s<=4?t.firstOnNewSystem&&0!=s&&(m.clef=m.CLE_SOL,i(!1),r(INIT_STAVE),f(!0,PHRASE_CLE_SOL,w),r(PHRASE_CLE_SOL)):s<=4&&s>0&&P[s-1].firstOnNewSystem&&(m.clef=m.CLE_FA,i(!1)),w++)}),this.tag||(r(MARGIN_BOTTOM),n(),_=1300),this.hideLoading(_)):this.tag&&(mesure=new this.VF.Stave(offsetX,offsetY,p),g&&mesure.addClef(g),E&&mesure.addTimeSignature(E),this.armature=o(this.armature,this),this.armature&&mesure.addKeySignature(this.armature),mesure.setContext(this.ctx).draw()),m=null,p=null,d=null,g=null,E=null,S=null,y=null,b=null},checkDuration:function(t,e,s){var i=0,a=this,r=0;if(Array.isArray(s))s.forEach(function(r,n){if(i+=a.checkDuration(t,e,r.duration),n==s.length-1&&i<t)for(var o=0;o<s.length;o++)switch(s[o].duration){case a.figure.NOIRE:if("8"==e)for(var c=s[o].note_heads.length;c-- >0;)s[o].addDot(c)}else if(i==e)return});else switch(s){case this.figure.RONDE:r=1;break;case this.figure.BLANCHE:r=2;break;case this.figure.NOIRE:r=4;break;case this.figure.CROCHE:r=8;break;case this.figure.DOUBLE_CROCHE:r=16;break;case this.figure.TRIPLE_CROCHE:r=32;break;case this.figure.QUADRUPLE_CROCHE:r=64}return e/r},calculOffsetX:function(t){for(var e=0,s=0,i=0;i<t;i++)i%2==0&&(e=this.partition.systeme.portee1[s]._width,this.mesStaticPart[i].firstOnNewSystem&&(this.offsetX=this.leftMargin),this.offsetX+=parseInt(e),s++);e=null},creerMelodieMesure:function(t,e,s,i,a,r){for(var n=[],o=i?this.CLE_SOL:this.CLE_FA,c=0;c<r.length;c++)Array.isArray(r[c])&&n.push(this.creerNote({tabNotes:s,numMes:t,measureType:o,notesParams:r[c]}));var f=a.split("/"),l=parseInt(f[0]),h=parseInt(f[1]);this.voices.push(new this.VF.Voice({num_beats:l,beat_value:h}).addTickables(n)),this.checkDuration(l,h,n),this.VF.Formatter.FormatAndDraw(this.ctx,e,n),this.mesMelodie.push([this.ctx,e,n])},creerNote:function(t){var e=this.CLE_SOL,s=["g/4"],i="q",a=[],r=!1,n=0,o=this;if(t&&(t.measureType&&(e=t.measureType),t.notesParams))switch(i=t.notesParams[0][1],stem=""!=t.notesParams[0][3]?t.notesParams[0][3]:0,stem){case"down":stem=-1;break;case"up":stem=1;break;default:stem=0}t.notesParams&&(s=[],t.notesParams.forEach(function(t){if(t[0][0]&&t[0][0].indexOf(".")>-1){var t=t[0][0],e=t.split(".");t[0]=e[0],a.push(n++),r=!0}else n++;s.push(o.genererNote(t))}));var c=new this.VF.StaveNote({clef:e,keys:s,duration:i,stem_direction:stem});a.length>0&&r&&a.forEach(function(t){c.addDot(parseInt(t))});for(var f=!1,l=-1,h=0;h<this.mesVF.length;h++)if(this.mesVF[h].numMes==t.numMes){l=h,f=!0;break}return f||(this.mesVF.push({numMes:t.numMes,notes:{cleSol:[],cleFa:[]}}),l=this.mesVF.length-1),e==this.CLE_SOL?this.mesVF[l].notes.cleSol.push(c):this.mesVF[l].notes.cleFa.push(c),c},genererNote:function(t){return t[0]+"/"+t[2]},calculPercent:function(t,e,s){return t?e*(100/s):e/100*s},sizingMeasures:function(t){function e(){i.mesDynamicPart=[],i.mesStaticPart.forEach(function(t,e){i.mesDynamicPart.push({});for(var s in t)i.mesDynamicPart[e][s]=t[s]})}function s(t,e){e>=0?(!t.print||"yes"!=t.print["_new-system"]&&"yes"!=t.print["_new-page"]||(i.mesStaticPart[e].firstOnNewSystem=!0,0!=e&&(i.offsetY+=2==i.NB_PORTEES_SYSTEME?250:120,i.mesStaticPart[e-2].lastOnOldSystem=!0)),i.mesStaticPart[e].offsetY=i.offsetY,t.print&&t.print["system-layout"]&&t.print["system-layout"]["system-margins"]&&t.print["system-layout"]["system-margins"]["left-margin"]&&(i.leftMargin=parseInt(t.print["system-layout"]["system-margins"]["left-margin"]),i.mesStaticPart[e].hasLeftMargin=!0,i.mesStaticPart[e].offsetX=i.leftMargin),t.attributes&&(t.attributes.time&&(i.chiffrage=t.attributes.time.beats+"/"+t.attributes.time["beat-type"],i.mesStaticPart[e].chiffrage=i.chiffrage),t.attributes.clef&&(i.clef="G"==t.attributes.clef.sign?i.CLE_SOL:i.CLE_FA,i.mesStaticPart[e].clef=i.clef),t.attributes.key&&(t.attributes.key.fifths&&(i.armature=t.attributes.key.fifths,i.mesStaticPart[e].armature=i.armature),t.attributes.key.mode&&(i.mode=t.attributes.key.mode))),i.mesStaticPart[e].hasLeftMargin||i.mesStaticPart[e].firstOnNewSystem||e>0&&"1"!=t._number&&i.calculOffsetX(e),i.mesStaticPart[e].hasLeftMargin||(i.mesStaticPart[e].offsetX=i.offsetX),i.mesStaticPart[e].width=parseInt(t._width)):(t.clef=null,t.chiffrage=null,t.armature=null,t.mode=null,t.firstOnNewSystem&&(o++,t.clef=i.clef,t.chiffrage=i.chiffrage,t.armature=i.armature,t.mode=i.mode))}var i=this,a=this.partition.systeme.portee1.length,a=2==this.NB_PORTEES_SYSTEME?2*a:a,r=null,n=0,o=0,c=[],f=0;if(this.offsetX=this.leftMargin=this.options.default.sidePadding,this.firstStart){for(var l=0;l<a;l++)this.mesStaticPart.push({}),2==this.NB_PORTEES_SYSTEME?n<a/2&&l%2==0?(r=this.partition.systeme.portee1[n],this.mesStaticPart[l].num=++n,s(r,l)):this.mesStaticPart[l].num=n:r=this.partition.systeme.portee1[l];this.firstStart=!1,r=null}if(this.NB_MAX_MEASURES>0){var h=0,u=0;this.offsetY=this.options.default.offsetY,e();for(var l=0;l<a;l++)l%2==0&&(this.mesDynamicPart[l].firstOnNewSystem=!1,this.mesDynamicPart[l].lastOnOldSystem=!1,0!=l&&h!=this.NB_MAX_MEASURES||(this.mesDynamicPart[l].firstOnNewSystem=!0,0!=l&&(this.mesDynamicPart[l-2].lastOnOldSystem=!0,this.offsetY+=this.partition.systeme.portee2?250:120,s(this.mesDynamicPart[l])),h=0),this.mesDynamicPart[l].offsetY=this.offsetY,this.mesDynamicPart[l].width=(window.innerWidth-2*this.leftMargin)/this.NB_MAX_MEASURES,this.mesDynamicPart[l].firstOnNewSystem?(this.mesDynamicPart[l].offsetX=this.leftMargin,u=0):(u+=this.mesDynamicPart[l].width,this.mesDynamicPart[l].offsetX=u+this.leftMargin),h++)}else this.responsive&&this.tag&&(e(),i.calculLargFromStaticPart(),this.mesDynamicPart.forEach(function(t,e){e%2==0&&s(t)}));this.creerMesure(!0,!1),i=null,a=null,c=null,f=null},calculLargFromStaticPart:function(){var t=this,e=window.innerWidth-2*this.options.default.sidePadding,s=parseInt(this.partition.infos.page.width),i=0,a=0,r=null,n=0,o=[],c=0,f=0,l=0,h=0;return this.mesDynamicPart.forEach(function(r,n){if(r.firstOnNewSystem){r.hasLeftMargin&&(f=r.offsetX,h=t.calculPercent(!0,f,s),c=t.calculPercent(!1,h,e));var o=0,u=0,m=[];indexMes=1==r.num?r.num-1:2*r.num-2;for(var p=r.num-1;p<t.mesStaticPart.length&&!(p<t.partition.systeme.portee1.length&&(m.push(parseFloat(t.partition.systeme.portee1[p]._width)),u+=m[o],o++,t.mesStaticPart[indexMes].lastOnOldSystem));p++)indexMes+=2;l=0!=c?c/m.length:0,i=s-u-f,i=Math.abs(i),h=t.calculPercent(!0,i,s),a=t.calculPercent(!1,h,e),l+=a/m.length,0!=n?t.offsetY+=t.partition.systeme.portee2?250:120:t.offsetY=t.options.default.offsetY,concatWidth=0,indexMes=1==r.num?r.num-1:2*r.num-2;for(var p=0;p<m.length;p++)h=t.calculPercent(!0,m[p],parseFloat(t.partition.infos.page.width)),t.mesDynamicPart[indexMes].width=t.calculPercent(!1,h,e)+l,0==p?t.mesDynamicPart[indexMes].offsetX=t.options.default.sidePadding:t.mesDynamicPart[indexMes].offsetX=concatWidth+t.options.default.sidePadding,t.mesDynamicPart[indexMes].offsetY=t.offsetY,concatWidth+=t.mesDynamicPart[indexMes].width,indexMes+=2;u=0,f=0,c=0,m=[],u=0}}),e=null,s=null,i=null,a=null,r=null,n=null,o=null,c=null,f=null,l=null,h=null,cpt=null,o}};